<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>透けない性格診断（20問）｜4タイプ×16動物</title>
  <style>

:root{
  /* Pop palette */
  --bg1:#fff7fb;
  --bg2:#f3fbff;

  --card:#ffffff;

  --txt:#1f2340;
  --muted:#515a7a;
  --muted2:#6b76a6;

  --acc:#ff4fb8;   /* pink */
  --acc2:#6c5cff;  /* pop purple */
  --acc3:#22c1ff;  /* sky */
  --ok:#16a34a;

  --line: rgba(31,35,64,.10);
  --line2: rgba(31,35,64,.16);

  --r-lg: 26px;
  --r-md: 18px;

  --shadow1: 0 14px 35px rgba(31,35,64,.10);
  --shadow2: 0 10px 22px rgba(255,79,184,.16);

  --focus: 0 0 0 4px rgba(255,79,184,.20), 0 0 0 1px rgba(255,79,184,.55);
}

*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;
  font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans JP", sans-serif;
  color:var(--txt);
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;

  /* Cute pop background */
  background:
    radial-gradient(900px 520px at 12% 0%, rgba(255,79,184,.18), transparent 60%),
    radial-gradient(900px 520px at 88% 6%, rgba(108,92,255,.18), transparent 60%),
    radial-gradient(700px 420px at 55% 105%, rgba(34,193,255,.16), transparent 55%),
    linear-gradient(180deg, var(--bg1), var(--bg2));

  position: relative;
  overflow-x: hidden;
}

/* Background texture & pop decorations */
body::before{
  content:"";
  position: fixed;
  inset: 0;
  pointer-events: none;
  z-index: 0;
  background-image:
    radial-gradient(circle, rgba(31,35,64,.10) 1px, transparent 1.5px);
  background-size: 18px 18px;
  background-position: 0 0;
  opacity: .35;
  mix-blend-mode: multiply;
}
body::after{
  content:"";
  position: fixed;
  inset: 0;
  pointer-events: none;
  z-index: 0;
  background:
    radial-gradient(26px 26px at 12% 12%, rgba(255,79,184,.22), transparent 62%),
    radial-gradient(18px 18px at 18% 20%, rgba(108,92,255,.18), transparent 62%),
    radial-gradient(14px 14px at 9% 24%, rgba(34,193,255,.18), transparent 62%),

    radial-gradient(20px 20px at 86% 10%, rgba(255,79,184,.18), transparent 64%),
    radial-gradient(14px 14px at 92% 18%, rgba(34,193,255,.18), transparent 64%),
    radial-gradient(10px 10px at 80% 20%, rgba(108,92,255,.16), transparent 64%),

    radial-gradient(22px 22px at 10% 88%, rgba(108,92,255,.14), transparent 66%),
    radial-gradient(14px 14px at 18% 82%, rgba(255,79,184,.14), transparent 66%),

    radial-gradient(28px 28px at 90% 86%, rgba(34,193,255,.14), transparent 66%);
  opacity: .9;
  filter: saturate(1.05);
}
@media (prefers-reduced-motion: no-preference){
  body::after{ animation: popFloat 12s ease-in-out infinite; }
  @keyframes popFloat{
    0%,100%{ transform: translate3d(0,0,0); }
    50%{ transform: translate3d(0,-10px,0); }
  }
}

.wrap{
  max-width:980px;
  margin:0 auto;
  padding:28px 16px 72px;
  position: relative;
  z-index: 1;
}

h1{margin:0 0 10px;font-size:22px;letter-spacing:.02em;line-height:1.25}
h2{margin:0 0 10px;font-size:18px;line-height:1.25}
h3{margin:0 0 8px;font-size:15px;line-height:1.25}

.sub{margin:0;color:var(--muted);line-height:1.85}

.hero,
.card{
  border-radius: var(--r-lg);
  border: 1px solid var(--line);
  background: rgba(255,255,255,.92);
  box-shadow: var(--shadow1);
  position: relative;
  overflow: hidden;
}

.hero{ padding:24px 18px; }

.hero::before,
.card::before{
  content:"";
  position:absolute;
  inset:-2px;
  background:
    radial-gradient(16px 16px at 14% 22%, rgba(255,79,184,.16), transparent 60%),
    radial-gradient(18px 18px at 78% 18%, rgba(108,92,255,.14), transparent 62%),
    radial-gradient(22px 22px at 86% 86%, rgba(34,193,255,.12), transparent 60%);
  pointer-events:none;
  opacity:.9;
}
.hero > *,
.card > *{position:relative}

.card{ margin-top:16px; padding:18px 16px; }

.pill{
  display:inline-flex;
  align-items:center;
  gap:8px;
  padding:8px 12px;
  border-radius:999px;
  background: linear-gradient(90deg, rgba(255,79,184,.12), rgba(108,92,255,.10));
  border:1px solid rgba(255,79,184,.18);
  color:var(--muted);
  font-size:12px;
  margin-top:12px;
}

.small{font-size:12px;color:var(--muted2);line-height:1.75}

.qhead{display:flex;justify-content:space-between;gap:12px;align-items:flex-start}
.qno{font-weight:1000;color:var(--txt);letter-spacing:.02em}
#answeredHint{
  padding:6px 10px;
  border-radius:999px;
  border:1px solid rgba(31,35,64,.10);
  background: rgba(31,35,64,.03);
}

.progress{
  height:12px;
  border-radius:999px;
  background: rgba(31,35,64,.06);
  overflow:hidden;
  margin:14px 0 6px;
  border:1px solid rgba(31,35,64,.06);
}
.bar{
  height:100%;
  width:0;
  background: linear-gradient(90deg, var(--acc), var(--acc2), var(--acc3));
  border-radius:999px;
  transition: width .28s ease;
}

.qtext{margin:12px 0 14px;line-height:1.95;color:var(--txt);font-weight:750}

.opts{display:grid;gap:10px}

label.opt{
  display:flex;
  gap:10px;
  align-items:flex-start;
  padding:14px 14px;
  border-radius: 20px;
  border: 1px solid rgba(31,35,64,.12);
  background: rgba(31,35,64,.02);
  cursor:pointer;

  transition:
    transform .06s ease,
    border-color .15s ease,
    background .15s ease,
    box-shadow .15s ease;
}

label.opt:hover{
  border-color: rgba(255,79,184,.35);
  background: linear-gradient(90deg, rgba(255,79,184,.06), rgba(108,92,255,.05));
  transform: translateY(-1px);
  box-shadow: 0 10px 22px rgba(31,35,64,.10);
}

input[type="radio"]{margin-top:3px;accent-color: var(--acc)}

label.opt:has(input[type="radio"]:checked){
  border-color: rgba(255,79,184,.55);
  background: linear-gradient(90deg, rgba(255,79,184,.10), rgba(108,92,255,.08));
  box-shadow: var(--shadow2);
}

button:focus-visible,
label.opt:focus-within,
a.cta:focus-visible{outline:none;box-shadow: var(--focus)}

.nav{display:flex;gap:10px;justify-content:space-between;margin-top:16px}

button{
  appearance:none;
  border:0;
  border-radius: 16px;
  padding:12px 14px;
  font-weight:1000;
  cursor:pointer;
  letter-spacing:.02em;
  transition: transform .06s ease, filter .15s ease, box-shadow .15s ease, border-color .15s ease;
}
button:active{transform: translateY(1px)}

.btn{
  background:#ffffff;
  color:var(--txt);
  border:1px solid rgba(31,35,64,.14);
  box-shadow: 0 8px 18px rgba(31,35,64,.08);
}
.btn:hover{border-color: rgba(108,92,255,.30);filter: brightness(1.01)}

.primary{
  background: linear-gradient(90deg, var(--acc), var(--acc2));
  color:#fff;
  box-shadow: 0 14px 26px rgba(255,79,184,.20), 0 10px 22px rgba(108,92,255,.18);
}
.primary:hover{filter: brightness(1.03)}

.ghost{background:transparent;border:1px dashed rgba(31,35,64,.22);color:var(--muted2)}

.hidden{display:none}

.typeBadge{
  display:inline-flex;
  align-items:center;
  gap:8px;
  margin-top:10px;
  padding:8px 12px;
  border-radius:999px;
  border:1px solid rgba(255,79,184,.25);
  background: linear-gradient(90deg, rgba(255,79,184,.12), rgba(108,92,255,.10));
  color:var(--txt);
  font-size:12px;
  font-weight:1000;
}

.section{
  margin-top:12px;
  padding:14px;
  border-radius: 20px;
  border:1px solid rgba(31,35,64,.10);
  background: linear-gradient(180deg, rgba(255,255,255,.82), rgba(255,255,255,.66));
}

.muted{color:var(--muted);line-height:1.9}

.grid{display:grid;gap:12px}
@media(min-width:860px){ .grid.two{grid-template-columns:1fr 1fr;} }

.list{margin:8px 0 0;padding-left:18px;color:var(--muted);line-height:1.9}
.list li{margin:4px 0}

.hr{
  height:1px;
  background: linear-gradient(90deg, rgba(255,79,184,.25), rgba(108,92,255,.20), rgba(34,193,255,.18));
  margin:14px 0;
  border-radius:999px;
}

.bigAnimal{font-size: 36px;font-weight: 1100;letter-spacing: .02em;line-height:1.1}

a.cta{
  display:inline-block;
  text-decoration:none;
  border-radius: 16px;
  padding:12px 14px;
  font-weight:1000;
  transition: transform .06s ease, filter .15s ease, box-shadow .15s ease, border-color .15s ease;
}
a.cta:active{transform: translateY(1px)}

.ctaRow{display:flex;flex-wrap:wrap;gap:10px;margin-top:12px}

.kicker{font-size:13px;color:var(--txt);font-weight:1000;margin-bottom:8px;letter-spacing:.02em}

.quote{
  border-left: 5px solid rgba(255,79,184,.65);
  padding:12px 12px 12px 14px;
  background: linear-gradient(90deg, rgba(255,79,184,.08), rgba(108,92,255,.05));
  border-radius: 16px;
  color:var(--txt);
  line-height:1.95;
  box-shadow: 0 10px 20px rgba(31,35,64,.08);
}
.quote h3{margin-top:10px}
.quote ul{margin:6px 0 0;padding-left:18px;color:var(--muted)}

.ok{color:var(--ok);font-weight:1000}

/* CTA links styling as buttons */
a.cta.primary{ color:#fff; box-shadow: 0 14px 26px rgba(255,79,184,.20), 0 10px 22px rgba(108,92,255,.18); }
a.cta.btn{ color:var(--txt); background:#fff; border:1px solid rgba(31,35,64,.14); box-shadow: 0 8px 18px rgba(31,35,64,.08); }
a.cta.btn:hover{ border-color: rgba(108,92,255,.30); filter: brightness(1.01); }

/* Responsive tweaks */
@media (min-width: 860px){
  .wrap{padding:34px 16px 80px}
  h1{font-size:24px}
  .card{padding:20px 18px}
  .qtext{font-size:16px}
}
@media (max-width: 420px){
  .nav{flex-direction:column}
  .nav button{width:100%}
  .ctaRow a.cta{width:100%; text-align:center}
}

/* Animal reveal fade-in (CSS only) */
#animalBox.hidden{
  display:block;
  opacity:0;
  transform: translateY(10px) scale(.99);
  max-height:0;
  overflow:hidden;
  pointer-events:none;
}
#animalBox{
  display:block;
  opacity:1;
  transform: translateY(0) scale(1);
  max-height: 2000px;
  overflow:hidden;
  transition:
    opacity .45s ease,
    transform .45s cubic-bezier(.2,.9,.2,1),
    max-height .55s ease;
  will-change: opacity, transform;
}
#animalBox.hidden #animalName,
#animalBox.hidden #animalDesc,
#animalBox.hidden #animalFull{
  opacity:0;
  transform: translateY(6px);
}
#animalBox #animalName{transition: opacity .45s ease .06s, transform .45s ease .06s;}
#animalBox #animalDesc{transition: opacity .45s ease .10s, transform .45s ease .10s;}
#animalBox #animalFull{transition: opacity .45s ease .14s, transform .45s ease .14s;}
#animalBox #animalName,
#animalBox #animalDesc,
#animalBox #animalFull{opacity:1;transform: translateY(0);}
@media (prefers-reduced-motion: reduce){
  #animalBox,
  #animalBox #animalName,
  #animalBox #animalDesc,
  #animalBox #animalFull{transition:none !important;}
  body::after{animation:none !important;}
}

/* Share buttons */
#share .ctaRow{align-items:center}
#share a.cta{user-select:none}
#share #btnCopyShare{white-space:nowrap}



  </style>
</head>
<body>
  <div class="wrap">
    <div class="hero" id="start">
      <h1>オリキャラ作れる性格診断（20問）｜4タイプ×16動物</h1>
      <p class="sub">
        直感でA/Bを選ぶだけ。<br/>
最後に「あなたの性質を象徴する存在」を提示します。
      </p>
      <div class="pill">所要：2〜3分 / HTML1枚で動作</div>
      <div class="ctaRow" style="margin-top:14px">
        <button class="primary" id="btnStart">診断をはじめる</button>
        <button class="btn" id="btnResetTop">リセット</button>
      </div>
      <p class="small">※リンク（購入/フォーム/LP）は後で差し替え可能。</p>
    </div>

    <div class="card hidden" id="quiz">
      <div class="qhead">
        <div>
          <div class="qno" id="qNo">Q1 / 20</div>
          <div class="small" id="qGroup">人との距離・エネルギー</div>
        </div>
        <div class="small" id="answeredHint">未回答</div>
      </div>
      <div class="progress"><div class="bar" id="bar"></div></div>
      <div class="qtext" id="qText"></div>
      <div class="opts" id="opts"></div>

      <div class="nav">
        <button class="btn" id="btnPrev">戻る</button>
        <button class="primary" id="btnNext">次へ</button>
      </div>
    </div>

    <div class="card hidden" id="loading">
      <h2>整理しています…</h2>
      <p class="muted">
        回答ありがとうございます。あなたの回答から性格の傾向を整理しています。
      </p>
      <div class="progress"><div class="bar" id="bar2" style="width:0"></div></div>
      <p class="small">（この演出は後で短く/消すこともできます）</p>
    </div>

    <div class="card hidden" id="result">
      <h2>診断結果</h2>
      <div class="typeBadge" id="typeBadge"></div>

      <div class="section">
        <div class="kicker">タイプ総評（読み物）</div>
        <div class="muted" id="typeOverview"></div>
        <div class="hr"></div>
        <div class="grid two">
          <div class="section" style="margin:0">
            <h3>このタイプの強み</h3>
            <ul class="list" id="typeStrengths"></ul>
          </div>
          <div class="section" style="margin:0">
            <h3>このタイプの落とし穴</h3>
            <ul class="list" id="typePitfalls"></ul>
          </div>
        </div>
      </div>

      <div class="section">
        <div class="kicker">あなたの傾向（ここでは動物は伏せます）</div>
        <div class="quote" id="hiddenProfile"></div>
      </div>

      <div class="section">
        <div class="kicker">演出</div>
        <div class="muted" id="stagingLine"></div>
        <div class="hr"></div>
        <button class="primary" id="btnReveal">答え合わせ（動物を表示）</button>
      </div>

      <div class="section hidden" id="animalBox">
        <div class="bigAnimal" id="animalName"></div>
        <div class="muted" id="animalDesc"></div>
        <div class="hr"></div>
        <div class="kicker">この動物タイプの詳細</div>
        <div class="quote" id="animalFull"></div>
      </div>

      <div class="section">
        <div class="kicker">商品導線</div>
        <div class="muted">
          この性格を「分身キャラ」として形にすることもできます。<br/>
          SNSアイコン／プロフィール／投稿トーンづくりに使えます。<br/>
          製作はインスタのDMからご依頼ください。
        </div>
        <div class="ctaRow">
          <a class="cta primary" href="https://www.instagram.com/digital_irasto?igsh=YWd2ZTJzeml2amI=" id="ctaIcon">STEP1：アイコン版を作る</a>
          <a class="cta btn" href="https://www.instagram.com/digital_irasto?igsh=YWd2ZTJzeml2amI=" id="ctaCommercial">STEP2：商用利用＋全身セット</a>
          <a class="cta btn" href="https://www.instagram.com/digital_irasto?igsh=YWd2ZTJzeml2amI=" id="ctaBrand">STEP3：ポーズ追加・ロゴ対応</a>
        </div>
        <p class="small">上記ボタンをタッチするとインスタアカウントに飛びます。そちらのアカウントにDMください。</p>
      </div>



      <div class="section" id="share">
        <div class="kicker">SNSでシェア</div>

        <div class="ctaRow" style="margin-top:12px">
          <a class="cta primary" href="#" id="btnShareX" rel="noopener">Xでシェア</a>
          <a class="cta btn" href="#" id="btnShareLine" rel="noopener">LINEで送る</a>
          <button class="btn" id="btnCopyShare">コピー</button>
        </div>
        <!-- ここにあった注意文（※リンクが「#」のままの場合は…）を削除しました -->
      </div>

<div class="ctaRow">
        <button class="btn" id="btnRestart">もう一度やる</button>
</div>
    </div>
  </div>

<script>
/* =========================
   質問（確定版）
========================= */
const questions = [
  { group:"人との距離・エネルギー", q:"一日を振り返ってモヤっとしやすいのはどっち？", A:"誰とも関わらなかった日", B:"一人の時間がほとんどなかった日" },
  { group:"人との距離・エネルギー", q:"一番避けたい状態は？", A:"場が静まり返ること", B:"話が表面的なまま終わること" },
  { group:"人との距離・エネルギー", q:"疲れている時、つい出る行動は？", A:"誰かと話して気を紛らわす", B:"一人になって頭を空っぽにする" },
  { group:"人との距離・エネルギー", q:"言われると少し引っかかるのは？", A:"「ノリで動いてるよね」", B:"「慎重すぎない？」" },
  { group:"人との距離・エネルギー", q:"余裕がない時の自分に近いのは？", A:"動いてるけど空回りしている", B:"動けず考え込んでしまう" },
  { group:"人との距離・エネルギー", q:"落ち込んだ時、回復が早いのは？", A:"人と会ったあと", B:"一人で過ごしたあと" },
  { group:"人との距離・エネルギー", q:"集まりの後、よく感じるのは？", A:"もっと話したかった", B:"ちょっと消耗した" },
  { group:"人との距離・エネルギー", q:"心のどこかで近いのは？", A:"誰かと一緒にいる方が楽", B:"一人の方が安心" },
  { group:"人との距離・エネルギー", q:"予定が急に空いたら？", A:"誰かに連絡してみる", B:"何も決めず一人で過ごす" },
  { group:"人との距離・エネルギー", q:"後悔しやすいのは？", A:"誘わなかったこと", B:"誘いを断らなかったこと" },

  { group:"思考の扱い方", q:"作ったものを見返して思うのは？", A:"もっと広げられた気がする", B:"もっと整えられた気がする" },
  { group:"思考の扱い方", q:"一番ストレスを感じるのは？", A:"途中で方向性が固まること", B:"ゴールが見えないまま進むこと" },
  { group:"思考の扱い方", q:"よくある失敗は？", A:"思いつきすぎて散らかる", B:"考えすぎて出せなくなる" },
  { group:"思考の扱い方", q:"言われるとモヤっとするのは？", A:"「発想は面白いけどまとまらない」", B:"「ちゃんとしてるけど面白みがない」" },
  { group:"思考の扱い方", q:"何か作る時、最初に近いのは？", A:"とりあえず手を動かす", B:"全体像を考える" },
  { group:"思考の扱い方", q:"余裕がない時に起きがちなのは？", A:"アイデアが止まらない", B:"細かいことが気になりすぎる" },
  { group:"思考の扱い方", q:"「今日はよくやった」と感じるのは？", A:"新しい発想が出た日", B:"きれいに仕上げられた日" },
  { group:"思考の扱い方", q:"途中で止まりやすいのは？", A:"もっと面白くできそうで", B:"まだ不完全に感じて" },
  { group:"思考の扱い方", q:"心のどこかで近いのは？", A:"ワクワクが一番大事", B:"納得感が一番大事" },
  { group:"思考の扱い方", q:"後悔しやすいのは？", A:"試さなかったこと", B:"詰めが甘かったこと" },
];

/* =========================
   タイプ別メタ
========================= */
const typeMeta = {
  "外向×発想": {
    label:"🟦 ムードメーカー型",
    overview:"人とのやり取りの中で頭が回り、反応があるほどエネルギーが出るタイプ。会話・場の空気・テンポからアイデアが湧きやすく、勢いで人を巻き込むのが得意です。",
    strengths:["共感や反応があると爆伸びする","発想の回転が速く、ネタが尽きにくい","場の空気を前向きに変える力がある","言葉やノリで人を動かしやすい"],
    pitfalls:["勢いで脱線しやすい","やることが増えすぎて散らかりがち","静かな環境だとパワーが落ちる","気分で出力がブレる"]
  },
  "外向×構造": {
    label:"🟧 プロデューサー型",
    overview:"人や情報をまとめて形にするのが得意な司令塔タイプ。状況判断が早く、方針を示すことで周りの迷いを減らせます。発信でも“筋の通った言葉”が強みになります。",
    strengths:["意思決定が早く、前に進められる","継続・実行が強い","全体像を見て整理できる","信頼を集めやすい言葉を出せる"],
    pitfalls:["正しさが強く出て固く見える","完璧を求めて疲れやすい","自分で抱え込みがち","面白みが薄いと言われてモヤる"]
  },
  "内向×発想": {
    label:"🟩 世界観クリエイター型",
    overview:"言葉にしきれない空気・感情・余韻を扱えるタイプ。強く主張しなくても、視点や表現が刺さります。“静かに深く届く発信”が武器になります。",
    strengths:["感性が鋭く、視点が独特","少ない言葉で余韻を作れる","距離感が魅力になりやすい","世界観づくりで強い"],
    pitfalls:["出力に時間がかかる","気分や環境で創作が止まりやすい","自分の中で完結して表に出ない","共感されないと落ち込みやすい"]
  },
  "内向×構造": {
    label:"🟪 戦略家タイプ",
    overview:"一人で完成度を上げていく職人タイプ。小さな違和感に気づき、改善を回して品質を上げられます。“積み上げ型の信頼”で長く強いです。",
    strengths:["分析・検証・改善が得意","慎重でミスが少ない","知識を深めて伝えられる","長期的な信頼を作れる"],
    pitfalls:["出すまでが長い（出せない）","細部が気になりすぎる","自己評価が厳しく疲れやすい","即興やノリが苦手で損しやすい"]
  }
};

/* =========================
   16動物（省略なし結果）＋公開後
========================= */
const animalsByType = {
  "外向×発想": [
    { emoji:"🐶", name:"犬",
      hiddenText:`あなたは「反応があるほど元気が増える」タイプ。人とのやり取りで気持ちが上向きやすく、場の空気を明るくする存在になりやすいです。思いついたら試してみる行動派で、熱が入ると一気に加速します。`,
      desc:"素直で感情が表に出る。応援されると爆伸び。",
      full:`<h3>🐶 犬タイプ｜どんな人？</h3>
<p><b>感情が透明で、愛嬌と熱量で人を安心させる</b>タイプ。嬉しい・悔しい・楽しいが自然に表に出て、周囲が「応援したくなる」空気を作ります。</p>
<h3>性格の核</h3>
<ul><li>まっすぐで素直（裏表が少ない）</li><li>反応があるほど力が出る</li><li>直感で動ける行動力</li></ul>
<h3>長所</h3>
<ul><li>場を明るくし、距離を縮めるのが得意</li><li>仲間意識が強く、関係が深い</li><li>熱量が乗った時の爆発力</li></ul>
<h3>弱点（出やすいクセ）</h3>
<ul><li>評価や空気に感情が揺れやすい</li><li>落ち込みが表に出やすい</li><li>寂しさに弱い</li></ul>`
    },
    { emoji:"🐻‍❄️", name:"しろくま",
      hiddenText:`あなたは「穏やかに見えて、内側は行動派」タイプ。空気をやわらげる安心感があり、周りが焦っていても自分は落ち着いて判断できます。目立とうとしないのに、気づけば中心にいることが多いです。`,
      desc:"おっとりして見えるが中身はアクティブ。空気を和ませ自然に注目される。",
      full:`<h3>🐻‍❄️ しろくまタイプ｜どんな人？</h3>
<p><b>安心感と行動力を同時に持つ</b>タイプ。穏やかで落ち着いて見えるのに、やると決めたら静かに前へ進みます。</p>
<h3>性格の核</h3>
<ul><li>包容力がある</li><li>マイペースだが芯は強い</li><li>周囲を落ち着かせる</li></ul>
<h3>長所</h3>
<ul><li>信頼されやすい</li><li>場を整える</li><li>静かに成果を出す</li></ul>
<h3>弱点（出やすいクセ）</h3>
<ul><li>頑張りが伝わりにくい</li><li>抱え込みやすい</li><li>主張が弱く見られることがある</li></ul>`
    },
    { emoji:"🐿️", name:"りす",
      hiddenText:`あなたは「好奇心が燃料で、集めながら理解する」タイプ。気になったことを拾っていくのが早く、引き出しが増えるほど賢くなります。集中が乗ると一気に進む反面、興味が移るのも早い傾向があります。`,
      desc:"好奇心で情報を集める。軽やかに動けるが散らかりがち。",
      full:`<h3>🐿️ りすタイプ｜どんな人？</h3>
<p><b>好奇心と軽やかさで世界を広げる</b>タイプ。小さな発見を集めて、あとで大きな強みに変えられます。</p>
<h3>性格の核</h3>
<ul><li>好奇心が強い</li><li>集めて整理して理解する</li><li>切り替えが早い</li></ul>
<h3>長所</h3>
<ul><li>情報収集がうまい</li><li>話題の引き出しが増えやすい</li><li>フットワークが軽い</li></ul>
<h3>弱点（出やすいクセ）</h3>
<ul><li>散らかりやすい</li><li>継続が課題になりやすい</li><li>飽きると止まる</li></ul>`
    },
    { emoji:"🦜", name:"オウム",
      hiddenText:`あなたは「言葉で感情を動かす」タイプ。相手の気持ちを言語化するのが上手く、短い一言で場の温度を変えることがあります。言い回しに敏感なぶん、誤解されると疲れやすい面も。`,
      desc:"言葉のセンスが武器。短文・キャッチコピーが強い。",
      full:`<h3>🦜 オウムタイプ｜どんな人？</h3>
<p><b>言語化と機転で印象を作る</b>タイプ。相手の気持ちを代弁できます。</p>
<h3>性格の核</h3>
<ul><li>言語化が鋭い</li><li>機転が利く</li><li>表現のセンスがある</li></ul>
<h3>長所</h3>
<ul><li>会話で存在感が出る</li><li>人の感情を言葉にできる</li><li>ユーモアが出せる</li></ul>
<h3>弱点（出やすいクセ）</h3>
<ul><li>言葉が強くなりすぎると誤解される</li><li>こだわりで疲れる</li><li>考えすぎて黙ることがある</li></ul>`
    },
  ],

  "外向×構造": [
    { emoji:"🦁", name:"ライオン",
      hiddenText:`あなたは「決めることで周りを安心させる」タイプ。迷いを放置せず、責任を取る前提で方向性を示せます。頼られるほど本気になる反面、弱音を出すのが遅くなりがちです。`,
      desc:"堂々としたリーダー。説得力がある。",
      full:`<h3>🦁 ライオンタイプ｜どんな人？</h3>
<p><b>決断と責任感で前に進める</b>タイプ。守る意識が強く、任されるほど力を出します。</p>
<h3>性格の核</h3>
<ul><li>責任感</li><li>決断の速さ</li><li>胆力</li></ul>
<h3>長所</h3>
<ul><li>頼られる</li><li>迷いを終わらせる</li><li>腹が決まると強い</li></ul>
<h3>弱点（出やすいクセ）</h3>
<ul><li>抱え込みやすい</li><li>強く見えすぎる</li><li>自分に厳しい</li></ul>`
    },
    { emoji:"🐎", name:"馬",
      hiddenText:`あなたは「感情より継続で勝つ」タイプ。派手さはなくても、淡々と続けられる力があります。途中で投げない安定感が信頼に直結しやすい反面、頑張りが伝わりにくいことも。`,
      desc:"継続力と実行力。淡々と結果を積み上げる。",
      full:`<h3>🐎 馬タイプ｜どんな人？</h3>
<p><b>継続が才能</b>タイプ。積み上げで強くなります。</p>
<h3>性格の核</h3>
<ul><li>堅実</li><li>習慣化</li><li>耐久力</li></ul>
<h3>長所</h3>
<ul><li>安定して強い</li><li>信用される</li><li>ブレにくい</li></ul>
<h3>弱点（出やすいクセ）</h3>
<ul><li>地味に見られがち</li><li>変化が遅いと思われる</li><li>自分を褒めるのが下手</li></ul>`
    },
    { emoji:"🦅", name:"ワシ",
      hiddenText:`あなたは「俯瞰して整理し、筋道を立てる」タイプ。感情よりも構造を先に捉えやすく、状況判断の精度が高いです。反面、雑談や曖昧な話が長いと消耗しやすい傾向があります。`,
      desc:"俯瞰視点が得意。戦略・分析系に強い。",
      full:`<h3>🦅 ワシタイプ｜どんな人？</h3>
<p><b>全体像で考える戦略家</b>タイプ。要点を掴み、優先順位を決められます。</p>
<h3>性格の核</h3>
<ul><li>洞察</li><li>合理性</li><li>構造化</li></ul>
<h3>長所</h3>
<ul><li>判断がブレない</li><li>問題解決が速い</li><li>説明が的確</li></ul>
<h3>弱点（出やすいクセ）</h3>
<ul><li>感情面が薄く見えることがある</li><li>曖昧さが苦手</li><li>整うまで出したくない</li></ul>`
    },
    { emoji:"🐺", name:"オオカミ",
      hiddenText:`あなたは「合理性と忠誠心が共存する」タイプ。広く浅くより、狭く深く信頼を築きます。納得できる基準があると強く、曖昧さが続くと距離を取りやすい人です。`,
      desc:"群れを大事にする合理派。",
      full:`<h3>🐺 オオカミタイプ｜どんな人？</h3>
<p><b>仲間を守る合理派</b>タイプ。身内には深く優しい。</p>
<h3>性格の核</h3>
<ul><li>合理性</li><li>忠誠心</li><li>基準づくり</li></ul>
<h3>長所</h3>
<ul><li>信頼が深い</li><li>チームの安定を作る</li><li>方針を示せる</li></ul>
<h3>弱点（出やすいクセ）</h3>
<ul><li>冷たく見られやすい</li><li>納得できないと動けない</li><li>距離が出る</li></ul>`
    },
  ],

  "内向×発想": [
    { emoji:"🐱", name:"猫",
      hiddenText:`あなたは「距離感と感性で魅力が出る」タイプ。無理に前へ出なくても、ふとした言葉や視点が印象に残ります。自分のペースが守られるほど、感覚が研ぎ澄まされやすい人です。`,
      desc:"気分屋だが感性が鋭い。距離感が魅力。",
      full:`<h3>🐱 猫タイプ｜どんな人？</h3>
<p><b>マイペースな感性派</b>タイプ。ちょうどいい距離が得意です。</p>
<h3>性格の核</h3>
<ul><li>感性</li><li>自由</li><li>観察</li></ul>
<h3>長所</h3>
<ul><li>独特の魅力</li><li>少ない言葉で刺さる</li><li>センスが出る</li></ul>
<h3>弱点（出やすいクセ）</h3>
<ul><li>波が出やすい</li><li>干渉が苦手</li><li>誤解されやすい</li></ul>`
    },
    { emoji:"🦊", name:"キツネ",
      hiddenText:`あなたは「斜めから本質を拾う」タイプ。みんなが流す違和感に気づき、言葉にすると鋭くなります。理解者がいるほど深く伸びる一方、合わない場では距離を取りたくなります。`,
      desc:"独特な視点と皮肉センス。余韻が強い。",
      full:`<h3>🦊 キツネタイプ｜どんな人？</h3>
<p><b>独自視点で核心を突く</b>タイプ。尖りが魅力にも誤解にもなります。</p>
<h3>性格の核</h3>
<ul><li>独自性</li><li>洞察</li><li>余韻</li></ul>
<h3>長所</h3>
<ul><li>切り口が唯一無二</li><li>本音を見抜く</li><li>知的に見える</li></ul>
<h3>弱点（出やすいクセ）</h3>
<ul><li>尖りが誤解される</li><li>孤独になりやすい</li><li>優しさを見せるのが照れる</li></ul>`
    },
    { emoji:"🐰", name:"ウサギ",
      hiddenText:`あなたは「共感と気配りが自然に出る」タイプ。相手の空気を察するのが早く、安心感を渡せます。そのぶん疲れも溜まりやすいので、我慢が続くと突然ガス欠しやすい傾向があります。`,
      desc:"繊細で優しい。安心感がある。",
      full:`<h3>🐰 ウサギタイプ｜どんな人？</h3>
<p><b>繊細で優しい共感者</b>タイプ。人の揺れに気づくのが早い。</p>
<h3>性格の核</h3>
<ul><li>共感</li><li>気配り</li><li>安心感</li></ul>
<h3>長所</h3>
<ul><li>信頼される</li><li>癒しになる</li><li>やさしい言葉が出る</li></ul>
<h3>弱点（出やすいクセ）</h3>
<ul><li>消耗しやすい</li><li>否定に敏感</li><li>本音を後回しにしがち</li></ul>`
    },
    { emoji:"🦌", name:"シカ",
      hiddenText:`あなたは「静かな芯と一貫した価値観」を持つタイプ。派手ではなくても、選び方や言葉に品が出ます。雑さが続くと疲れやすく、整った環境ほど本領が出やすい人です。`,
      desc:"静かで芯がある。美意識が強い。",
      full:`<h3>🦌 シカタイプ｜どんな人？</h3>
<p><b>品と芯の強さ</b>タイプ。落ち着きと一貫性が武器です。</p>
<h3>性格の核</h3>
<ul><li>美意識</li><li>価値観</li><li>一貫性</li></ul>
<h3>長所</h3>
<ul><li>信頼が積もる</li><li>大人っぽい</li><li>判断がブレにくい</li></ul>
<h3>弱点（出やすいクセ）</h3>
<ul><li>こだわりで遅くなる</li><li>合わない場で黙りやすい</li><li>雑音に弱い</li></ul>`
    },
  ],

  "内向×構造": [
    { emoji:"🐧", name:"ペンギン",
      hiddenText:`あなたは「慎重で確実性を重視する」タイプ。急がない代わりにミスが少なく、信頼を長期で積みます。焦らされると止まりやすいですが、自分のペースが守られるほど安定して力を出せる人です。`,
      desc:"慎重で確実。静かに積み上げる安定派。",
      full:`<h3>🐧 ペンギンタイプ｜どんな人？</h3>
<p><b>慎重さと確実さで信頼を積む</b>タイプ。急がず、丁寧に、崩れない土台を作ります。</p>
<h3>性格の核</h3>
<ul><li>慎重</li><li>堅実</li><li>継続</li></ul>
<h3>長所</h3>
<ul><li>ミスが少ない</li><li>信用される</li><li>長期で強い</li></ul>
<h3>弱点（出やすいクセ）</h3>
<ul><li>動き出しが遅い</li><li>急かされると止まりやすい</li><li>自信が育つまで時間がかかる</li></ul>`
    },
    { emoji:"🐹", name:"ハムスター",
      hiddenText:`あなたは「改善で強くなる」タイプ。小さな違和感に気づき、試行錯誤で完成度を上げていきます。自己評価が厳しくなりやすいので、十分できていても“まだ足りない”と感じやすい傾向があります。`,
      desc:"小さな改善をコツコツ回す。分析・検証が得意。",
      full:`<h3>🐹 ハムスタータイプ｜どんな人？</h3>
<p><b>改善職人</b>タイプ。小さな差分で強くなります。</p>
<h3>性格の核</h3>
<ul><li>改善</li><li>検証</li><li>丁寧さ</li></ul>
<h3>長所</h3>
<ul><li>完成度を上げ続ける</li><li>成長が止まりにくい</li><li>信頼を積む</li></ul>
<h3>弱点（出やすいクセ）</h3>
<ul><li>こだわりで止まる</li><li>自己評価が厳しい</li><li>疲れが溜まりやすい</li></ul>`
    },
    { emoji:"🦉", name:"フクロウ",
      hiddenText:`あなたは「理解を深めてから動く」タイプ。知識欲が強く、筋が通っていないことが苦手です。納得できるまで整理したい反面、準備が長くなると動き出しが遅くなりがちです。`,
      desc:"知識と洞察の象徴。理解が深い。",
      full:`<h3>🦉 フクロウタイプ｜どんな人？</h3>
<p><b>知性と洞察で支える</b>タイプ。理解してから強い。</p>
<h3>性格の核</h3>
<ul><li>知識欲</li><li>洞察</li><li>構造理解</li></ul>
<h3>長所</h3>
<ul><li>説得力がある</li><li>理解が深い</li><li>判断の質が高い</li></ul>
<h3>弱点（出やすいクセ）</h3>
<ul><li>調べすぎて止まる</li><li>難しくなりやすい</li><li>整うまで出したくない</li></ul>`
    },
    { emoji:"🐻", name:"クマ",
      hiddenText:`あなたは「寡黙でも頼れる」タイプ。感情を表に出しにくいぶん、芯が太くブレにくいです。距離が縮まるほど面倒見がよく、信頼関係が深いほど強さが出ます。`,
      desc:"無口だが頼れる。専門性と安心感。",
      full:`<h3>🐻 クマタイプ｜どんな人？</h3>
<p><b>静かな信頼</b>タイプ。深い関係ほど面倒見が良い。</p>
<h3>性格の核</h3>
<ul><li>落ち着き</li><li>責任感</li><li>芯の太さ</li></ul>
<h3>長所</h3>
<ul><li>安心感</li><li>ブレない</li><li>信頼が長続き</li></ul>
<h3>弱点（出やすいクセ）</h3>
<ul><li>近寄りにくい印象</li><li>主張が弱く見える</li><li>慣れるまで距離が出る</li></ul>`
    },
  ],
};

/* =========================
   判定ロジック（透けない）
========================= */
function computeResult(answers){
  let ext=0,intro=0,insp=0,struct=0;

  for(let i=0;i<20;i++){
    const v = answers[i];
    if(i < 10){
      if(v === "A") ext++; else intro++;
    }else{
      if(v === "A") insp++; else struct++;
    }
  }

  const ei = (ext === intro) ? (answers[0] === "A" ? "外向" : "内向") : (ext > intro ? "外向" : "内向");
  const ns = (insp === struct) ? (answers[10] === "A" ? "発想" : "構造") : (insp > struct ? "発想" : "構造");
  const typeKey = `${ei}×${ns}`;

  // 再現性あるseed（回答のA位置を足す）
  const seed = answers.reduce((s,v,i)=> s + (v==="A" ? (i+1) : 0), 0);
  const idx = seed % 4;

  const animal = animalsByType[typeKey][idx];
  return { typeKey, idx, animal, scores:{ext,intro,insp,struct} };
}

/* =========================
   UI
========================= */
const el = (id)=>document.getElementById(id);

const start = el("start");
const quiz = el("quiz");
const loading = el("loading");
const result = el("result");

const qNo = el("qNo");
const qGroup = el("qGroup");
const qText = el("qText");
const opts = el("opts");
const bar = el("bar");
const bar2 = el("bar2");
const answeredHint = el("answeredHint");

const btnStart = el("btnStart");
const btnResetTop = el("btnResetTop");
const btnPrev = el("btnPrev");
const btnNext = el("btnNext");
const btnRestart = el("btnRestart");
const btnReveal = el("btnReveal");

const typeBadge = el("typeBadge");
const typeOverview = el("typeOverview");
const typeStrengths = el("typeStrengths");
const typePitfalls = el("typePitfalls");

const hiddenProfile = el("hiddenProfile");
const stagingLine = el("stagingLine");
const animalBox = el("animalBox");
const animalName = el("animalName");
const animalDesc = el("animalDesc");
const animalFull = el("animalFull");

let cur = 0;
let answers = Array(20).fill(null);

function show(section){
  [start,quiz,loading,result].forEach(s=>s.classList.add("hidden"));
  section.classList.remove("hidden");
}

function renderList(ul, items){
  ul.innerHTML = "";
  items.forEach(x=>{
    const li = document.createElement("li");
    li.textContent = x;
    ul.appendChild(li);
  });
}

function renderQuestion(){
  const q = questions[cur];
  qNo.textContent = `Q${cur+1} / 20`;
  qGroup.textContent = q.group;
  qText.textContent = q.q;

  const selected = answers[cur];
  answeredHint.textContent = selected ? `回答済：${selected}` : "未回答";

  const pct = Math.round(((cur)/20)*100);
  bar.style.width = pct + "%";

  opts.innerHTML = "";
  const mk = (key, text)=>{
    const label = document.createElement("label");
    label.className = "opt";
    label.innerHTML = `<input type="radio" name="q${cur}" value="${key}" ${selected===key?"checked":""}/>
      <div><div style="font-weight:1000">${key}</div><div class="muted">${text}</div></div>`;
    label.querySelector("input").addEventListener("change",(e)=>{
      answers[cur] = e.target.value;
      answeredHint.textContent = `回答済：${answers[cur]}`;
    });
    return label;
  };
  opts.appendChild(mk("A", q.A));
  opts.appendChild(mk("B", q.B));

  btnPrev.disabled = (cur===0);
  btnPrev.classList.toggle("ghost", cur===0);
  btnNext.textContent = (cur===19) ? "結果を見る" : "次へ";
}

function allAnswered(){ return answers.every(v=>v==="A"||v==="B"); }

function goNext(){
  if(!answers[cur]){
    alert("A/Bどちらか選んでね。");
    return;
  }
  if(cur < 19){
    cur++;
    renderQuestion();
    return;
  }
  if(!allAnswered()){
    alert("未回答があるよ。");
    return;
  }
  show(loading);
  bar2.style.width = "0%";
  let t = 0;
  const timer = setInterval(()=>{
    t += 14;
    bar2.style.width = Math.min(t,100) + "%";
    if(t>=100){
      clearInterval(timer);
      renderResult();
    }
  }, 110);
}

function goPrev(){
  if(cur>0){
    cur--;
    renderQuestion();
  }
}

function renderResult(){
  const r = computeResult(answers);
  const tm = typeMeta[r.typeKey];

  typeBadge.textContent = `${tm.label}`;
  typeOverview.textContent = tm.overview;
  renderList(typeStrengths, tm.strengths);
  renderList(typePitfalls, tm.pitfalls);

  // 省略なし本文（HTML）
  hiddenProfile.innerHTML = `<p>${r.animal.hiddenText}</p>`;

  // 演出文
  const stagingByType = {
    "外向×発想":"この性質は、人の中でこそ輝くエネルギーを持っています。もし、この感覚をひとつの存在に例えるとしたら──",
    "外向×構造":"この性質は、人を前に進める力として現れます。もし、この在り方をひとつの存在に例えるとしたら──",
    "内向×発想":"この性質は、言葉にしきれない空気や感情としてにじみ出ます。もし、この感覚をひとつの存在に例えるとしたら──",
    "内向×構造":"この性質は、静かな信頼感として積み重なっていきます。もし、この在り方をひとつの存在に例えるとしたら──",
  };
  stagingLine.textContent = stagingByType[r.typeKey];

  // 公開ボタン設定
  animalBox.classList.add("hidden");
  btnReveal.disabled = false;
  btnReveal.textContent = "答え合わせ（動物を表示）";

  btnReveal.onclick = ()=>{
    animalName.textContent = `${r.animal.emoji} ${r.animal.name}`;
    animalDesc.textContent = r.animal.desc;
    animalFull.innerHTML = r.animal.full;
    animalBox.classList.remove("hidden");
    btnReveal.disabled = true;
    btnReveal.textContent = "表示しました";
  };

  show(result);
}

function resetAll(){
  cur = 0;
  answers = Array(20).fill(null);
  bar.style.width = "0%";
  bar2.style.width = "0%";
  show(start);
}

btnStart.addEventListener("click", ()=>{
  show(quiz);
  cur = 0;
  renderQuestion();
});
btnResetTop.addEventListener("click", resetAll);
btnPrev.addEventListener("click", goPrev);
btnNext.addEventListener("click", goNext);
btnRestart.addEventListener("click", resetAll);

show(start);


/* =========================
   SNSシェア（X / LINE / コピー）
   - テキストは既存DOM(#typeBadge, #animalNameなど)から生成
   - 公開URLがある場合は location.href をそのまま使います
========================= */
const buildShareText = () => {
  const type = (document.getElementById('typeBadge')?.textContent || '').trim();
  const animal = (document.getElementById('animalName')?.textContent || '').trim();
  const base = '透けない性格診断（20問）｜4タイプ×16動物';
  // 動物表示前はanimalが空のことがあるので分岐
  if (animal) return `${base}\n診断結果：${type}\n動物：${animal}`;
  return `${base}\n診断結果：${type}`;
};

const getShareUrl = () => {
  // # だけのローカル実行でも動くように、URLは現在URLを使う
  return location.href;
};

const openShare = (url) => {
  window.open(url, '_blank', 'noopener,noreferrer');
};

const setupShareButtons = () => {
  const btnX = document.getElementById('btnShareX');
  const btnLine = document.getElementById('btnShareLine');
  const btnCopy = document.getElementById('btnCopyShare');
  if (!btnX || !btnLine || !btnCopy) return;

  const updateLinks = () => {
    const text = buildShareText();
    const shareUrl = getShareUrl();
    const x = `https://twitter.com/intent/tweet?text=${encodeURIComponent(text)}&url=${encodeURIComponent(shareUrl)}`;
    const line = `https://social-plugins.line.me/lineit/share?url=${encodeURIComponent(shareUrl)}&text=${encodeURIComponent(text)}`;

    btnX.href = x;
    btnLine.href = line;
  };

  // 初期化
  updateLinks();

  // 動物を表示した後もテキストを更新
  const btnReveal = document.getElementById('btnReveal');
  if (btnReveal) btnReveal.addEventListener('click', () => setTimeout(updateLinks, 0));

  // X/LINEはクリック時に念のため再生成してから遷移
  btnX.addEventListener('click', (e) => {
    e.preventDefault();
    updateLinks();
    openShare(btnX.href);
  });
  btnLine.addEventListener('click', (e) => {
    e.preventDefault();
    updateLinks();
    openShare(btnLine.href);
  });

  // コピー（URL＋本文）
  btnCopy.addEventListener('click', async () => {
    const text = buildShareText();
    const shareUrl = getShareUrl();
    const payload = `${text}\n${shareUrl}`;
    try{
      await navigator.clipboard.writeText(payload);
      const old = btnCopy.textContent;
      btnCopy.textContent = 'コピーしました';
      setTimeout(() => btnCopy.textContent = old, 1200);
    }catch(err){
      // フォールバック
      const ta = document.createElement('textarea');
      ta.value = payload;
      ta.style.position = 'fixed';
      ta.style.left = '-9999px';
      document.body.appendChild(ta);
      ta.select();
      document.execCommand('copy');
      document.body.removeChild(ta);
      const old = btnCopy.textContent;
      btnCopy.textContent = 'コピーしました';
      setTimeout(() => btnCopy.textContent = old, 1200);
    }
  });
};

// DOM構築後に初期化
if (document.readyState === 'loading') {
  document.addEventListener('DOMContentLoaded', setupShareButtons);
} else {
  setupShareButtons();
}
</script>
</body>
</html>
